<!doctype html>
<html>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="HandheldFriendly" content="true" />

    <title>CS 4802 - Assignment 1</title>
    <link href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css' rel='stylesheet'>
    <script src='http://code.jquery.com/jquery.min.js'></script>
    <script src='http://d3js.org/d3.v3.min.js' charset='utf-8'></script>
    <script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js'></script>

    <style>
        *:focus {
            outline: none !important;
        }
    </style>

    <body class='container'>
        <h1>CS 4802 - Assignment 1 <br class='visible-xs-block'/> <small>The Game of Life</small></h1>
        <hr/>

        <div class='row'>
            <div class='col-md-2'>
                <div class='panel panel-default'>
                    <div class='panel-heading'><h2 class='panel-title'>Cells</h2></div>
                    <div class='panel-body'>
                        <button id='kill-all-button' class='btn btn-danger form-control' onclick='board.killAll(); render()'>
                            <span class='glyphicon glyphicon-remove'></span>
                            Kill All
                        </button>
                        <button id='randomize-button' class='btn btn-default form-control' onclick='board.randomize(); render()'>
                            <span class='glyphicon glyphicon-random'></span>
                            Randomize
                        </button>
                    </div>
                </div>
            </div>
            <div class='col-md-6'>
                <div class='panel panel-default'>
                    <div class='panel-body'>
                        <div id='boardContainer'></div>
                    </div>
                    <div class='panel-footer'>
                        <button id='play-button' class='btn btn-primary' onclick='play();'>
                            <span class='glyphicon glyphicon-play'></span><br class='visible-xs-block'/>
                            Play
                        </button>
                        <button id='pause-button' class='btn btn-primary' onclick='pause();'>
                            <span class='glyphicon glyphicon-pause'></span><br class='visible-xs-block'/>
                            Pause
                        </button>
                        <button id='step-button' class='btn btn-default' onclick='board.step(); render()'>
                            <span class='glyphicon glyphicon-step-forward'></span><br class='visible-xs-block'/>
                            Step
                        </button>
                    </div>
                </div>
            </div>
            <div class='col-md-4'>
                <div class='panel panel-default'>
                    <div class='panel-heading'><h2 class='panel-title'>Game Presets</h2></div>
                    <div class='panel-body'>
                        <div id='presetsContainer'></div>
                    </div>
                </div>
                <div class='panel panel-default'>
                    <div class='panel-heading'><h2 class='panel-title' id='gameTitle'></h2></div>
                    <div class='panel-body'>
                        <p>A cell changes state if it's:</p>
                        <div id='rulesContainer'></div>
                    </div>
                </div>
            </div>
        </div>

        <script src='gamePresets.js'></script>
        <script src='board.js'></script>
        <script>
            var cellSize = 24;
            var board = new Board(50)

            /* Make an SVG object to render to. */
            var boardSvg = d3.select('#boardContainer').append('svg')
                .attr('viewBox', '0 0 ' + (cellSize * board.size - 2) + ' ' + (cellSize * board.size - 2))
                .attr('width', '100%')
                .attr('height', '100%')

            /* Make a div to show the list of game rules in */
            var ruleList = d3.select('#rulesContainer').append('div').attr('class', 'list-group')

            /* Make a div to show the list of rule presets */
            var presetsList = d3.select('#presetsContainer').append('div').attr('class', 'list-group')

            /**
             * Draws the current board to the page by rendering squares in a uniform cartesian grid. Squares are
             * rendered only in locations where the cell is alive.
             */
            var render = function() {
                var cells = boardSvg.selectAll('rect').data(board.cells)
                cells.enter().append('rect')
                    .style('fill', 'black')
                    .attr('width', cellSize - 2)
                    .attr('height', cellSize - 2)
                    .attr('x', function(cell) { return cellSize * cell.x })
                    .attr('y', function(cell) { return cellSize * cell.y })

                /* Make cells that are alive visible and cells that are dead hidden */
                cells.style('visibility', function(cell) { return cell.isAlive? 'visible' : 'hidden' })

                /* Render the list of rule presets */
                var presets = presetsList.selectAll('a').data(gamePresets)
                presets.enter().append('a')
                    .text(function(game) { return game.name })
                    .on('click', function(game) { board.game = game; render() })

                /* The currently assigned one should be styled as active */
                presets.classed({'list-group-item': true, 'active': function(game) { return game == board.game } })

                /* Render the list of rules */
                d3.select('#gameTitle').text(board.game.name)

                var rules = ruleList.selectAll('div').data(board.game.rules)
                rules.enter().append('div').attr('class', 'list-group-item')
                rules.exit().remove()
                rules.html(function(rule) {
                    return '<b>' + (rule.aliveBefore? 'alive' : 'dead') + '</b> and has <b>' +
                    rule.minNeighborCount + '</b> to <b>' + rule.maxNeighborCount + '</b> neighbors'
                })
            }

            /**
             * Starts periodically updating the board
             */
            var playId = undefined;
            var play = function() {
                board.step()
                render()
                playId = setInterval(function() { board.step(); render() }, 100)

                /* Disable all settings besides pause, and hide the play button. */
                d3.selectAll('button').attr('disabled', true)
                d3.select('#pause-button').attr('disabled', null)
                d3.select('#pause-button').style('display', 'inline-block')
                d3.select('#play-button').style('display', 'none')
            }

            /**
            * Stops periodically updating the board
            */
            var pause = function() {
                if (playId) {
                    clearInterval(playId)
                }

                /* Re-enable all settings, and hide the pause button. */
                d3.selectAll('button').attr('disabled', null)
                d3.select('#pause-button').style('display', 'none')
                d3.select('#play-button').style('display', 'inline-block')
            }

            pause()
            board.randomize()
            render()
        </script>
    </body>
</html>
